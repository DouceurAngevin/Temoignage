<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Carrousel ‚Äî infini, 2 pleines + 1 peek gauche + 1 peek droite</title>
<style>
  :root{
    --bg:#191919; --surface:#2f3437; --card:#2a2f32; --text:#f7f6f3; --muted:#9b9a97; --accent:#f1f1ef;

    --gap:14px;
    --peek:32px;                           /* d√©bord sym√©trique g/d (peeks) */
    --radius:12px;
    --shadow:0 18px 40px rgba(15,15,15,.55);
    --transition:600ms cubic-bezier(.22,.61,.36,1);

    /* 2 cartes pleines visibles en desktop */
    --card-width: calc((100% - var(--gap)) / 2);

    color-scheme:dark;
  }

  *{ box-sizing:border-box; }

  body{
    margin:0;
    background:var(--bg);
    color:var(--text);
    font:16px/1.6 "Inter","Segoe UI",-apple-system,BlinkMacSystemFont,"Helvetica Neue",Arial,sans-serif;
    padding: clamp(20px,4vh,36px) clamp(16px,4vw,28px);
    overflow-x:hidden;
  }

  .wrap{ width:100%; margin:0 auto; }
  .carousel{ position:relative; isolation:isolate; }

  /* Peeks sym√©triques via padding L/R identique */
  .viewport{
  overflow:hidden;
  padding:6px var(--peek);
  position:relative;
  z-index:0;            /* üîΩ on baisse le viewport sous les fl√®ches */
  touch-action:pan-y;
}


  .track{
    display:flex; align-items:stretch; gap:var(--gap);
    will-change:transform;
    transition: transform var(--transition);
    padding:8px 0;
  }

  .card{
    flex:0 0 var(--card-width);
    background:var(--card);
    border:1px solid rgba(255,255,255,.06);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:18px 18px 16px;
    display:grid; gap:12px; min-height:150px;
  }

  .quote{ font-size:16px; font-weight:600; letter-spacing:.01em; line-height:1.55; }
  .meta{ color:var(--muted); font-size:13px; line-height:1.5; white-space:pre-line; }

  /* Fl√®ches hors overflow (toujours visibles) */
  .nav{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  width:34px; height:34px;
  display:grid; place-items:center;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.08);
  background:var(--surface);
  box-shadow:inset 0 0 0 1px rgba(255,255,255,.03);
  backdrop-filter:blur(8px);
  cursor:pointer;
  user-select:none;
  transition: background .2s ease, opacity .2s ease;
  opacity:.95;

  /* ‚úÖ Fix cliquabilit√© */
  z-index:9999;           /* toujours au-dessus */
  pointer-events:auto;    /* capte bien les clics */
}

  .nav:hover{ background:rgba(63,69,72,.85); opacity:1; }
  .prev{ left:8px; }
  .next{ right:8px; }
  .nav svg{ width:14px; height:14px; color:var(--accent); }

  /* Mobile : 1 carte (peeks non garantis si tr√®s √©troit) */
  @media (max-width:600px){
    :root{ --peek:18px; --gap:12px; --card-width:100%; }
    body{ padding: clamp(18px,5vh,24px) 18px clamp(18px,5vh,24px); }
    .card{ min-height:0; padding:16px; }
  }
  @media (max-width:420px){ :root{ --peek:14px; } }
  @media (max-width:360px){ :root{ --peek:12px; } .quote{ font-size:15px; } }
</style>
</head>
<body>
  <div class="wrap">
    <div class="carousel" aria-label="Carrousel de t√©moignages">
      <!-- fl√®che gauche -->
      <button class="nav prev" aria-label="T√©moignages pr√©c√©dents">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
             stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
      </button>

      <!-- viewport avec peeks sym√©triques -->
      <div class="viewport">
        <div class="track" role="list">
          <article class="card" role="listitem">
            <div class="quote">‚ÄúOn a doubl√© notre taux de conversion en 8 semaines, sans augmenter le trafic.‚Äù</div>
            <div class="meta">‚Äî Responsable e-commerce, Maison Pinet
‚Üí La mission : audit + r√©√©criture des pages produit</div>
          </article>
          <article class="card" role="listitem">
            <div class="quote">‚ÄúClair, net, efficace. Les emails de relance ont relanc√©‚Ä¶ notre croissance.‚Äù</div>
            <div class="meta">‚Äî Head of Sales, TechNova
‚Üí La mission : s√©quence d‚Äôemails + scripts d‚Äôappels</div>
          </article>
          <article class="card" role="listitem">
            <div class="quote">‚ÄúEnfin un messaging qui parle √† nos clients industriels ‚Äî et qui vend.‚Äù</div>
            <div class="meta">‚Äî Directeur Commercial, FerraSteel
‚Üí La mission : positionnement + pages solutions</div>
          </article>
          <article class="card" role="listitem">
            <div class="quote">‚ÄúLe configurateur est devenu notre meilleur commercial.‚Äù</div>
            <div class="meta">‚Äî CEO, Hedonia
‚Üí La mission : UX copy du configurateur + offres</div>
          </article>
          <article class="card" role="listitem">
            <div class="quote">‚ÄúNos appels sont plus courts et concluent plus. Les scripts font la diff√©rence.‚Äù</div>
            <div class="meta">‚Äî Sales Ops, IndusFlow
‚Üí La mission : scripts d‚Äôappel + objection-handling</div>
          </article>
          <article class="card" role="listitem">
            <div class="quote">‚ÄúDes textes qui sonnent juste et une ligne √©ditoriale qui f√©d√®re.‚Äù</div>
            <div class="meta">‚Äî CMO, Sur La Route Des Saveurs
‚Üí La mission : charte √©dito + landing</div>
          </article>
        </div>
      </div>

      <!-- fl√®che droite -->
      <button class="nav next" aria-label="T√©moignages suivants">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
             stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
      </button>
    </div>
  </div>

<script>
(function(){
  const viewport = document.querySelector('.viewport');
  const track = document.querySelector('.track');
  const prevBtn = document.querySelector('.prev');
  const nextBtn = document.querySelector('.next');

  const STEP = 1;              // 1 carte par clic
  const AUTOPLAY_MS = 0;       // mets 10000 si tu veux l‚Äôautoplay

  let slides = Array.from(track.children);
  let index = 0;               // index courant (sur la liste AVEC clones)
  let timer = null;

  // Helpers
  const css  = (el, prop) => parseFloat(getComputedStyle(el)[prop]) || 0;
  const peek = () => css(viewport,'paddingLeft'); // L/R identiques
  const gap  = () => (getComputedStyle(track).columnGap ? css(track,'columnGap') : css(track,'gap'));
  const cardW= () => slides[0]?.getBoundingClientRect().width || 0;

  // Nombre de cartes PLEINES visibles (‚âà2 en desktop)
  function getVisible(){
    const inner = viewport.getBoundingClientRect().width - css(viewport,'paddingLeft') - css(viewport,'paddingRight');
    const w = cardW() + gap();
    // floor pour √©viter de ‚Äúsurcompter‚Äù en cas de peeks
    return Math.max(1, Math.floor( (inner + gap() - 1) / w ));
  }

  // Cr√©e/Reset les clones pour la boucle infinie
  function setupClones(){
    // supprime anciens clones (tout ce qui n'a pas data-original)
    Array.from(track.children).forEach(n => { if(!n.dataset.original) n.remove(); });
    slides = Array.from(track.children);
    slides.forEach(n => n.dataset.original = '1');

    const V = Math.max(1, getVisible());  // 2 en desktop
    const head = slides.slice(0, V+1).map(n => { const c=n.cloneNode(true); c.dataset.original=''; return c; });
    const tail = slides.slice(-V-1).map(n => { const c=n.cloneNode(true); c.dataset.original=''; return c; });

    tail.forEach(n => track.insertBefore(n, track.firstChild));
    head.forEach(n => track.appendChild(n));

    slides = Array.from(track.children);  // liste avec clones

    // Position de d√©part : juste apr√®s les clones de t√™te
    index = V + 1;

    // Place le track pour avoir : 1 peek gauche + 2 pleines + 1 peek droite
    requestAnimationFrame(()=> goTo(index, false));
  }

  function goTo(i, withTransition=true){
    const x = - (i * (cardW() + gap())) + peek();
    track.style.transition = withTransition ? '' : 'none';
    track.style.transform = `translate3d(${x}px,0,0)`;
    index = i;
  }

  function next(){ goTo(index + STEP, true); }
  function prev(){ goTo(index - STEP, true); }

  // Rebouclage silencieux apr√®s transition (infini r√©el)
  track.addEventListener('transitionend', ()=>{
    const total = slides.length;
    const V = Math.max(1, getVisible());

    // si on est pass√© dans les clones de droite ‚Üí on ‚Äúsaute‚Äù √† la m√™me vue c√¥t√© original
    if(index >= total - (V + 1)){
      goTo(V + 1, false);
    }
    // si on est pass√© dans les clones de gauche ‚Üí on ‚Äúsaute‚Äù √† la m√™me vue c√¥t√© original
    if(index <= V){
      goTo(total - (V + 2), false);
    }
  });

  // Drag (swipe)
  let startX=0, dx=0, dragging=false, baseX=0;
  viewport.addEventListener('pointerdown', (e)=>{
    dragging = true;
    startX = e.clientX;
    track.style.transition = 'none';
    const m = track.style.transform.match(/-?\d+\.?\d*/);
    baseX = m ? parseFloat(m[0]) : 0;
    viewport.setPointerCapture?.(e.pointerId);
    stopAutoplay();
  });
  addEventListener('pointermove', (e)=>{
    if(!dragging) return;
    dx = e.clientX - startX;
    track.style.transform = `translate3d(${baseX + dx}px,0,0)`;
  });
  addEventListener('pointerup', (e)=>{
    if(!dragging) return;
    dragging = false;
    const threshold = Math.max(30, cardW()*0.15);
    if(dx < -threshold) next();
    else if(dx > threshold) prev();
    else goTo(index, true);
    dx = 0;
    viewport.releasePointerCapture?.(e.pointerId);
    startAutoplay();
  });

  // Autoplay (optionnel)
  function startAutoplay(){
    if(!AUTOPLAY_MS) return;
    stopAutoplay();
    timer = setInterval(next, AUTOPLAY_MS);
  }
  function stopAutoplay(){ if(timer){ clearInterval(timer); timer=null; } }
  ['mouseenter','focusin'].forEach(evt => viewport.addEventListener(evt, stopAutoplay));
  ['mouseleave','focusout'].forEach(evt => viewport.addEventListener(evt, startAutoplay));

  // Rebuild clones quand tu changes la taille de l‚Äôembed (pour garder 2 pleines + peeks)
  let resizeRaf=null;
  addEventListener('resize', ()=>{
    if(resizeRaf) cancelAnimationFrame(resizeRaf);
    resizeRaf = requestAnimationFrame(setupClones);
  });

  // Init
  setupClones();
  startAutoplay();
})();
</script>
</body>
</html>
